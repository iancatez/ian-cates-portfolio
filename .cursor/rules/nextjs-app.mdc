---
description: Next.js App Router patterns, server components, and data fetching rules.
globs: app/**/*
---
# Next.js Best Practices

### App Router Patterns
- **Use Server Components by default** - only use `'use client'` when needed
- **Mark client components** with `'use client'` directive at the top
- **Use async Server Components** for data fetching
- **Leverage loading.tsx and error.tsx** for better UX
- **Use route groups** `(folder)` for organization without affecting URLs

### Data Fetching
- **Use async/await** in Server Components
- **Fetch data at the component level** that needs it
- **Use `cache()` and `unstable_cache()`** for request deduplication
- **Handle errors gracefully** with error boundaries

### Performance
- **Use `next/image`** for all images
- **Lazy load components** with `dynamic()` when appropriate
- **Optimize fonts** with `next/font`
- **Use `generateStaticParams`** for static pages when possible
- **Implement proper loading states**

### Examples
```tsx
// ✅ GOOD: Server Component with async
export default async function ProjectsPage() {
  const projects = await fetchProjects()
  return <ProjectsList projects={projects} />
}

// ✅ GOOD: Client Component marked properly
'use client'
import { useState } from 'react'
export function InteractiveComponent() {
  // ...
}
```

### Next.js Specific Types
- **Use `Metadata` type** from `next` for page metadata
- **Type page params** with `{ params: { id: string } }`
- **Use `React.ReactNode`** for children props
- **Type API routes** with proper request/response types
